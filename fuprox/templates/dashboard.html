{% extends 'layout.html'%}
<!--css requires for chart.js-->
<!--end of css requires-->
<!--here we are going to add chart.js and excelGen files -->

{% block nav%}
    <div class="navbar-collapse collapse offset-md-5" id="navbarDefault">
        <ul class="navbar-nav">
          <li class="nav-item active">
            <a class="nav-link" href="{{ url_for('home') }}">Home</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="{{ url_for('branches') }}">Cntry/Brnch</a>
          </li>

          <li class="nav-item">
            <a class="nav-link" href="{{ url_for('payments') }}">Payments</a>
          </li>

        <li class="nav-item">
            <a class="nav-link " href="{{ url_for('extras') }}">Extras</a>
          </li>

          <li class="nav-item">
            <a class="nav-link " href="{{ url_for('help') }}">Help</a>
          </li>
          <li class="nav-item">
                <a class="nav-link " href="{{ url_for('logout') }}" style="color:red;">Logout</a>
          </li>
        </ul>
      </div>
{% endblock %}
{% block status%}
  <section class="intro-single">
    <div class="container">
      <div class="row">
        <div class="col-md-12 col-lg-8">
          <div class="title-single-box">
            <h5 style="font-size:15px;">Dashboard / <span style="color:grey;">Home</span> </h5>
            <span class="color-text-a"></span>
          </div>
        </div>
      </div>
    </div>
  </section>
{% endblock%}
{% block content %}
<h5><small class="text-muted">{{today}}</small></h5>
<br>
    <div class="row col-lg-12">
    <div class="col-lg-5" id="graphs">
        	<canvas id="doughnut" width="120" height="75"></canvas>
            <script>
                var ctx = document.getElementById('doughnut').getContext('2d');
                var doughnut = new Chart(ctx, {
                    type: 'doughnut',
                    data: {
                        labels: ["New","Assigned","Resolved","Closed"],
                        datasets: [
                            {
                                label: "Population (millions)",
                                backgroundColor: ["Red","Orange","Yellow","Green"],
                                data: [1,4,2,0]
                            }
                        ]
                    },
                    options: {
                        title: {
                            display: true,
                            text: 'Summary Of  Todays Bookings'
                        }
                    }
                });
            </script>
        </div>
        <div class="col-lg-6 offset-lg-1" id="graphs">
        <canvas id="myChart" width="110" height="65"></canvas>
        <script>
            var ctx = document.getElementById('myChart').getContext('2d');
            var myChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: [1,2,3,4,5,6,7,8,9,10,11,12,13,14,15],
                    datasets: [{
                        steppedLine : "after",
                        label:"Requests Serviced",
                        data: [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
                        backgroundColor: [
                            'rgba(255, 99, 132, 0.2)',
                            'rgba(54, 162, 235, 0.2)',
                            'rgba(255, 206, 86, 0.2)',
                            'rgba(75, 192, 192, 0.2)',
                            'rgba(153, 102, 255, 0.2)',
                            'rgba(255, 159, 64, 0.2)'
                        ],
                        borderColor: [
                            'rgba(255, 99, 132, 1)',
                            'rgba(54, 162, 235, 1)',
                            'rgba(255, 206, 86, 1)',
                            'rgba(75, 192, 192, 1)',
                            'rgba(153, 102, 255, 1)',
                            'rgba(255, 159, 64, 1)'
                        ],
                        borderWidth: 1
                    }]
                },
                options: {
                    title: {
                        display: true,
                        text: 'Task Lists for The Last 15 Days'
                    },
                    scales: {
                        yAxes: [{
                            ticks: {
                                beginAtZero: true
                            }
                        }]
                    }
                }
            });
        </script>
        </div>
    </div>
<style>
    .widget_card{
        border-radius:10px;
        padding :15px 10px 20px 20px;
        background-color : #efefef;
        height : 120px;
        margin-bottom : 20px;
        cursor : pointer;
    }
    .header{
        font-size : 16px;
        font-weight : 600;
        color : #999;
    }

    .body {
        font-size : 14px;
        color : #555;
    }
    span.time{
        color :#aaa;
        font-size : 12px;
    }
    .urgent{
        color : red;
        font-weight : 600;
        margin-left : 130px;
        font-size : 10px;
        border : 2px solid red;
        padding : 2px 4px;
        border-radius : 4px;
    }
    .medium{
        border : 2px solid blue;
        color : blue;
    }
    .inHeaders{
        font-size : 16px;
        font-weight : 600;
        text-align:center;
        color : #777;
    }
    .reports{
        margin-left : 0px;
    }
    #frequency{
        margin-right : 40px;
    }
    .reports{
        margin-left:-30px;
    }
</style>
<br>
    <div class=""><br>
        <h5 id="section">Reports</h5>
        <div class="text-muted">Please Select Either of the links to generete reports.</div><br>
        <!-- <div class="alert alert-danger col-lg-5 alert-dismissible" role="alert" id="error" style="display:none;">
            Sorry, Data For This Kind Of Report Does Not Exists Yet.
          </div> -->
          <div class="alert alert-info col-lg-5" style="display:none" role="alert" id="generating">
            Generating Report.
          </div>
          <!-- <div class="alert alert-success col-lg-5" style="display:none" role="alert" id="done">
            &#128076; Report Successfully Generated.
          </div> -->
        <div class="alert alert-success col-lg-5" style="display:none" role="alert" id="error">
            &#128076; Report Successfully Generated.
        </div>
        <div class="reports row col-lg-12">
        <!-- Report Type -->
        <div class="col-lg-3">
                <label for="frequency">Duration</label>
                <select class="form-control form-control-sm" id="frequency" name="frequency" onchange="getFrequency(this);">
                        <option id="periodOne"  selected value="null">Select The Frequency</option>
                        <option class="period" id="daily" value="day">Daily Reports</option>
                        <option class="period" id="weekly" value="week">Weekly Reports</option>
                        <option class="period" id="monthly" value="month">monthly Reports</option>
                    </select>
        </div>
            <div class="col-lg-3" >
                    <label for="type">Issue Type</label>
                    <select class="form-control form-control-sm" id="type" name="type"  disabled>
                            <option id="statusOne" selected value="null">Issue Type</option>
                            <option class="status" id="all" value="6">All Issues</option>
                            <option class="status" id="new" value="0">New Issues</option>
                            <option class="status" id="assigned" value="1">Assigned Issues</option>
                            <option class="status" id="resolved" value="2">Resolved Issues</option>
                            <option class="status" id="escalated" value="5">Escalated Issues</option>
                            <option class="status" id="closed" value="3">Closed Issues</option>
                        </select>
            </div>

            <!-- time -->
            <div class="col-lg-3" id="dateCont">
                <label for="date">Select Date</label>
                <input readonly type="text" class="form-control form-control-sm" id="date" name="datePackerOne">
            </div>

            <div class="col-lg-3" id="monthCont" style="display: none;" >
                    <label for="month">Select Month</label>
                    <input readonly type="text" class="form-control form-control-sm" id="month" name="weekNumber">
            </div>

            <!-- week numebers -->
            <div class="col-lg-3" id="weekCont" style=" display:none"  >
                <label for="weeks">Select Week</label>
                <select class="form-control form-control-sm" id="weeks" name="weeks" onmouseover="updateWeek(this)">
                        <option id="weekNumber" selected value="null">Week Number</option>
                        <option class="week" id="one" value="1">Week One </option>
                        <option class="week" id="two" value="2">Week Two</option>
                        <option class="week" id="three" value="3">Week Three </option>
                        <option class="week" id="four" value="4">Week Four </option>
                        <option class="week" id="five" value="5">Week Five </option>
                    </select>
            </div>

        </div><br><br>
        <button class="btn btn-primary btn-sm col-lg-2" id="generate" >Generate Report</button>
    </div>
    <br><br>
    <div class="reportDiv">
        <!-- report container -->
        <table class="table table-striped table-bordered table-hover" style="display:none" id="report">
            <thead>
            <tr>
                <th scope="col" id="issueid">Issue ID</th>
                <th scope="col" id="from">Requestor</th>
                <th scope="col" id="subject">Subject</th>
                <th scope="col" id="dateReceived">Date Recieved</th>
                <th scope="col" id="assignedTo">Assigned To</th>
                <th scope="col" id="dateAssigned">Date Assigned</th>
                <th scope="col" id="resolvedBy">Resolved By</th>
                <th scope="col" id="resolveDate">Date Resolved</th>
                <th scope="col" id="dateClosed">Date Closed</th>
                <th scope="col" id="solution">Solution</th>
                <th scope="col" id="reason">Reason</th>
            </tr>
            </thead>
            <tbody id="reportBody" >
            </tbody>
        </table>
    </div>

<script>
    function getFrequency(item){
    thisVal =  item.value;
    if(thisVal === "null"){
        $("#type").prop("disabled",true);
        $("#statusOne").prop("selected",true);
    }else if(thisVal === 'day'){
        $("#type").removeAttr("disabled");
        $("#dateCont").show();
        $("#monthCont").hide();
        $("#weekCont").hide();
    }else if(thisVal === "week"){
        $("#type").removeAttr("disabled");
        $("#dateCont").hide();
        $("#monthCont").show();
        $("#weekCont").show();

    }else if(thisVal === 'month'){
        $("#type").removeAttr("disabled");
        $("#dateCont").hide();
        $("#monthCont").show();
        $("#weekCont").hide();
    }
}

const daysInMonth  = (month, year) => {
    return new Date(year, month, 0).getDate();
}

const updateWeek = (item) => {
    let month = $("#month").val()
    if(month !== ""){
        let daysInMonths = new Date(month);
        let yearDate = daysInMonths.getFullYear();
        let monthDate = daysInMonths.getMonth()+1;
        var days = daysInMonth(monthDate,yearDate);
        let weeks = Math.floor(days/7);
        let extraDays = days%7;
        if(extraDays > 0){
            // five weeks
            $("#five").show();
        }else{
            // four weeks
            $("#five").hide();
        }
    }else{
        let error = $("#error");
        let monthHandle = $("#month");
        error.html("Month Required. Please Select Select A Month")
        error.show();
        monthHandle.addClass("is-invalid")
        setTimeout(()=>{
            error.hide()
            monthHandle.removeClass("is-invalid")
        },5000);
    }
}

const datePicker = (handle) =>{
    $(`#handle`).datepicker({
        language: 'en',
        startDate: start,
        autoClose : true,
        view : "months",
        minView : "months",
        maxDate : start,
        dataMinView : "months",
        dataView : "months",
        position: "top left",
        onSelect: function (fd, d, picker) {
            // Do nothing if selection was cleared
            if (!d) return;
            var day = d.getDay();
            // Trigger only if date is changed
            if (prevDay !== undefined && prevDay === day) return;
            prevDay = day;
            // If chosen day is Saturday or Sunday when set
            // hour value for weekends, else restore defaults
            if (day === 6 || day === 0) {
                picker.update({
                    minHours: 10,
                    maxHours: 16
                })
            } else {
                picker.update({
                    minHours: 9,
                    maxHours: 18
                })
            }
        }
    });
}

const weekPicker = (handle) => {
    $(`#handle`).datepicker({
        timepicker: true,
        language: 'en',
        startDate: start,
        minHours: startHours,
        maxHours: 18,
        onSelect: function (fd, d, picker) {
            // Do nothing if selection was cleared
            if (!d) return;

            var day = d.getDay();

            // Trigger only if date is changed
            if (prevDay !== undefined && prevDay === day) return;
            prevDay = day;

            // If chosen day is Saturday or Sunday when set
            // hour value for weekends, else restore defaults
            if (day === 6 || day === 0) {
                picker.update({
                    minHours: 10,
                    maxHours: 16
                })
            } else {
                picker.update({
                    minHours: 9,
                    maxHours: 18
                })
            }
        }
    });
}


    $(`#date`).datepicker({
        language: 'en',
        startDate: new Date(),
        autoClose: true,
        view: "years",
        maxDate: new Date(),
        dataView: "months",
        position: "top left",
        onSelect: function (fd, d, picker) {
            // Do nothing if selection was cleared
            if (!d) return;
            var day = d.getDay();
            // Trigger only if date is changed
            if (prevDay !== undefined && prevDay === day) return;
            prevDay = day;
            // If chosen day is Saturday or Sunday when set
            // hour value for weekends, else restore defaults
            if (day === 6 || day === 0) {
                picker.update({
                    minHours: 10,
                    maxHours: 16
                })
            } else {
                picker.update({
                    minHours: 9,
                    maxHours: 18
                })
            }
        }
    });



</script>

{% endblock %}